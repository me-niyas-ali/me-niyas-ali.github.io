<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1.0" />
 <title>Text Share</title>
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-4" style="max-width: 850px;">
 <h2 class="text-center mb-4">Text Share ğŸ”—</h2>
 <!-- Tabs -->
 <ul class="nav nav-tabs justify-content-center" id="tabs" role="tablist">
  <li class="nav-item" role="presentation">
   <button class="m-0 text-black nav-link active" id="share-tab" data-bs-toggle="tab" data-bs-target="#share" type="button" role="tab"><span style="font-size:1.5em">ğŸ”—</span> Share</button>
  </li>
  <li class="nav-item" role="presentation">
   <button class="m-0 text-black nav-link" id="retrieve-tab" data-bs-toggle="tab" data-bs-target="#retrieve" type="button" role="tab"><span style="font-size:1.5em">ğŸ“¥</span> Retrieve</button>
  </li>
  <li class="nav-item" role="presentation">
   <button class="m-0 text-black nav-link" id="about-tab" data-bs-toggle="tab" data-bs-target="#about" type="button" role="tab"><span style="font-size:1.5em">â„¹ï¸</span> About</button>
  </li>
 </ul>

 <!-- Tab Content -->
 <div class="tab-content mt-4">

  <!-- Share Tab -->
  <div class="tab-pane fade show active" id="share" role="tabpanel">
   <div class="position-relative">
    <textarea id="textInput" class="form-control mb-3" placeholder="Enter your text to share..." style="min-height: 30vh;"></textarea>
    <button id="pasteButton" class="btn position-absolute top-0 end-0 mt-3 bg-gradient me-3" style="background-color:#bababa;font-size:1.4rem" title="Paste">ğŸ“‹</button>
   </div>
   <select id="expirySelect" class="form-select mb-3">
    <option value="600000" selected>Expires in 10 minutes</option>
    <option value="1800000">Expires in 30 minutes</option>
    <option value="3600000">Expires in 1 hour</option>
    <option value="21600000">Expires in 6 hours</option>
    <option value="43200000">Expires in 12 hours</option>
   </select>
   <button id="shareButton" class="btn btn-primary w-100 mb-3">Share</button>
   <div id="shareCode" class="border rounded p-3 text-center bg-white" style="display: none;">
    <span id="codeText" class="d-block mb-2 fw-semibold"></span>
    <button id="copyButton" class="btn btn-success w-100">Copy</button>
   </div>
  </div>

  <!-- Retrieve Tab -->
  <div class="tab-pane fade" id="retrieve" role="tabpanel">
   <input id="retrieveInput" class="form-control mb-3" placeholder="Enter 4-digit code to retrieve..." />
   <button id="retrieveButton" class="btn btn-primary w-100 mb-3">Retrieve</button>
   <div class="position-relative">
    <textarea id="retrievedText" class="form-control" readonly placeholder="Retrieved text will appear here..." style="min-height: 30vh;"></textarea>
    <button id="copyRetrieved" class="btn position-absolute top-0 end-0 mt-2 bg-gradient me-3" style="background-color:#bababa;font-size:1.4rem" title="Copy text">ğŸ“„</button>
   </div>
  </div>

  <!-- About Tab -->
  <div class="tab-pane fade" id="about" role="tabpanel">
   <div class="card card-body bg-white">
    <h5 class="card-title">About This App</h5>
    <p class="card-text">Text Share is a quick tool to share short messages using 4-digit codes. No login needed. Paste, share, and retrieve on any device within the time limit.</p>
    <p class="card-text">All messages are stored securely on Firebase and deleted after expiry.</p>
   </div>
  </div>
 </div>
</div>
<div class="text-center bottom-0 position-fixed w-100 pb-2 mb-2">Made with <span class='text-danger'>&#10084;</span> by <a href="https://ali-niyas.blogspot.com/" target="_blank" title="W3.CSS">Niyas Ali</a></div>


<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Firebase & App Logic -->
<script type="module">
 import {
  initializeApp
 } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
 import {
  getDatabase,
  ref,
  set,
  get,
  child,
  remove
 } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";

 const firebaseConfig = {
  apiKey: "AIzaSyBRA6iq8p_2NI4JzpCK2f4vkMWsRMhDin4",
  authDomain: "text-share-31553.firebaseapp.com",
  databaseURL: "https://text-share-31553-default-rtdb.firebaseio.com",
  projectId: "text-share-31553",
  storageBucket: "text-share-31553.appspot.com",
  messagingSenderId: "813153545432",
  appId: "1:813153545432:web:4f40e2e3b5cdd8436dbbad"
 };

 const app = initializeApp(firebaseConfig);
 const db = getDatabase(app);

 const shareButton = document.getElementById("shareButton");
 const retrieveButton = document.getElementById("retrieveButton");
 const textInput = document.getElementById("textInput");
 const retrieveInput = document.getElementById("retrieveInput");
 const shareCode = document.getElementById("shareCode");
 const codeText = document.getElementById("codeText");
 const copyButton = document.getElementById("copyButton");
 const retrievedText = document.getElementById("retrievedText");
 const expirySelect = document.getElementById("expirySelect");
 const pasteButton = document.getElementById("pasteButton");
 const copyRetrieved = document.getElementById("copyRetrieved");

 const ding = new Audio("https://me-niyas-ali.github.io/getfile/notify.mp3");

 function generateCode() {
  return Math.floor(1000 + Math.random() * 9000).toString();
 }

 async function generateUniqueCode() {
  let code, exists;
  do {
   code = generateCode();
   const snapshot = await get(child(ref(db), "texts/" + code));
   exists = snapshot.exists();
  } while (exists);
  return code;
 }

 async function saveText(code, text, expiry) {
  const timestamp = Date.now();
  await set(ref(db, "texts/" + code), { text, timestamp, expiry });
 }

 async function getText(code) {
  const snapshot = await get(child(ref(db), "texts/" + code));
  if (snapshot.exists()) {
   const data = snapshot.val();
   const now = Date.now();
   if (now - data.timestamp > data.expiry) {
    await remove(ref(db, "texts/" + code));
    return { expired: true };
   }
   return { text: data.text, timeLeft: data.expiry - (now - data.timestamp) };
  }
  return null;
 }

 shareButton.addEventListener("click", async () => {
  const text = textInput.value.trim();
  if (!text) {
   codeText.textContent = "Please enter some text.";
   shareCode.style.display = "block";
   return;
  }
  const expiry = parseInt(expirySelect.value);
  const code = await generateUniqueCode();
  await saveText(code, text, expiry);
  codeText.innerHTML = `âœ… <strong>Share code:</strong> ${code}`;
  shareCode.style.display = "block";
  copyButton.setAttribute("data-code", code);
  ding.play();
 });

 retrieveButton.addEventListener("click", async () => {
  const code = retrieveInput.value.trim();
  const result = await getText(code);
  if (!result) {
   retrievedText.value = "No text found.";
  } else if (result.expired) {
   retrievedText.value = "Code expired.";
  } else {
   const mins = Math.ceil(result.timeLeft / 60000);
   retrievedText.value = `(Expires in ${mins} min${mins > 1 ? "s" : ""})\n\n${result.text}`;
   ding.play();
  }
 });

 copyButton.addEventListener("click", () => {
  const code = copyButton.getAttribute("data-code");
  navigator.clipboard.writeText(code).then(() => {
   copyButton.textContent = "âœ…";
   ding.play();
   setTimeout(() => copyButton.textContent = "Copy", 2000);
  });
 });

 pasteButton.addEventListener("click", async () => {
  try {
   const text = await navigator.clipboard.readText();
   textInput.value = text;
   textInput.focus();
   pasteButton.textContent = "âœ…";
   ding.play();
   setTimeout(() => pasteButton.textContent = "ğŸ“‹", 2000);
  } catch {
   alert("Clipboard access denied.");
  }
 });

 copyRetrieved.addEventListener("click", async () => {
  try {
   await navigator.clipboard.writeText(retrievedText.value);
   ding.play();
   copyRetrieved.textContent = "âœ…";
   setTimeout(() => (copyRetrieved.textContent = "ğŸ“„"), 2000);
  } catch {
   alert("Failed to copy.");
  }
 });
</script>
</body>
</html>